/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
!function(a){"use strict";function b(a){this.withCredentials=!1,this.responseType="",this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=q,this.onreadystatechange=q,this._contentType="",this._xhr=a,this._sendTimeout=0,this._abort=q}function c(a){this._xhr=new b(a)}function d(){this._listeners=Object.create(null)}function e(a){k(function(){throw a},0)}function f(a){this.type=a,this.target=void 0}function g(a,b){f.call(this,a),this.data=b.data,this.lastEventId=b.lastEventId}function h(a,b){d.call(this),this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this._close=void 0,j(this,a,b)}function i(){if("undefined"==typeof m&&"undefined"!=typeof n)return n;var a=new m;return"undefined"==typeof a.withCredentials?n:m}function j(a,b,d){b=String(b);var h=void 0!=d&&Boolean(d.withCredentials),j=E(1e3),m=void 0!=d&&void 0!=d.heartbeatTimeout?D(d.heartbeatTimeout,45e3):E(45e3),n="",o=j,p=!1,q=void 0!=d&&void 0!=d.headers?JSON.parse(JSON.stringify(d.headers)):void 0,B=void 0!=d&&void 0!=d.Transport?d.Transport:i(),C=new c(new B),G=0,H=r,I="",J="",K="",L="",M=w,N=0,O=0,P=function(b,c,d){if(H===s)if(200===b&&void 0!=d&&A.test(d)){H=t,p=!0,o=j,a.readyState=t;var g=new f("open");a.dispatchEvent(g),F(a,a.onopen,g)}else{var h="";200!==b?(c&&(c=c.replace(/\s+/g," ")),h="EventSource's response has a status "+b+" "+c+" that is not 200. Aborting the connection."):h="EventSource's response has a Content-Type specifying an unsupported type: "+(void 0==d?"-":d.replace(/\s+/g," "))+". Aborting the connection.",e(new Error(h)),S();var g=new f("error");a.dispatchEvent(g),F(a,a.onerror,g)}},Q=function(b){if(H===t){for(var c=-1,d=0;d<b.length;d+=1){var e=b.charCodeAt(d);(e==="\n".charCodeAt(0)||e==="\r".charCodeAt(0))&&(c=d)}var f=(-1!==c?L:"")+b.slice(0,c+1);L=(-1===c?L:"")+b.slice(c+1),""!==f&&(p=!0);for(var h=0;h<f.length;h+=1){var e=f.charCodeAt(h);if(M===v&&e==="\n".charCodeAt(0))M=w;else if(M===v&&(M=w),e==="\r".charCodeAt(0)||e==="\n".charCodeAt(0)){if(M!==w){M===x&&(O=h+1);var i=f.slice(N,O-1),q=f.slice(O+(h>O&&f.charCodeAt(O)===" ".charCodeAt(0)?1:0),h);"data"===i?(I+="\n",I+=q):"id"===i?J=q:"event"===i?K=q:"retry"===i?(j=D(q,j),o=j):"heartbeatTimeout"===i&&(m=D(q,m),0!==G&&(l(G),G=k(function(){T()},m)))}if(M===w){if(""!==I){n=J,""===K&&(K="message");var r=new g(K,{data:I.slice(1),lastEventId:J});if(a.dispatchEvent(r),"message"===K&&F(a,a.onmessage,r),H===u)return}I="",K=""}M=e==="\r".charCodeAt(0)?v:w}else M===w&&(N=h,M=x),M===x?e===":".charCodeAt(0)&&(O=h+1,M=y):M===y&&(M=z)}}},R=function(){if(H===t||H===s){H=r,0!==G&&(l(G),G=0),G=k(function(){T()},o),o=E(Math.min(16*j,2*o)),a.readyState=s;var b=new f("error");a.dispatchEvent(b),F(a,a.onerror,b)}},S=function(){H=u,C.cancel(),0!==G&&(l(G),G=0),a.readyState=u},T=function(){if(G=0,H!==r)return void(p?(p=!1,G=k(function(){T()},m)):(e(new Error("No activity within "+m+" milliseconds. Reconnecting.")),C.cancel()));p=!1,G=k(function(){T()},m),H=s,I="",K="",J=n,L="",N=0,O=0,M=w;var a=b;"data:"!==b.slice(0,5)&&"blob:"!==b.slice(0,5)&&(a=b+(-1===b.indexOf("?",0)?"?":"&")+"lastEventId="+encodeURIComponent(n));var c={};if(c.Accept="text/event-stream",void 0!=q)for(var d in q)Object.prototype.hasOwnProperty.call(q,d)&&(c[d]=q[d]);try{C.open(P,Q,R,a,h,c)}catch(f){throw S(),f}};a.url=b,a.readyState=s,a.withCredentials=h,a._close=S,T()}var k=a.setTimeout,l=a.clearTimeout,m=a.XMLHttpRequest,n=a.XDomainRequest,o=a.EventSource,p=a.document;null==Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b});var q=function(){};b.prototype.open=function(a,b){this._abort(!0);var c=this,d=this._xhr,e=1,f=0;this._abort=function(a){0!==c._sendTimeout&&(l(c._sendTimeout),c._sendTimeout=0),(1===e||2===e||3===e)&&(e=4,d.onload=q,d.onerror=q,d.onabort=q,d.onprogress=q,d.onreadystatechange=q,d.abort(),0!==f&&(l(f),f=0),a||(c.readyState=4,c.onreadystatechange())),e=0};var g=function(){if(1===e){var a=0,b="",f=void 0;if("contentType"in d)a=200,b="OK",f=d.contentType;else try{a=d.status,b=d.statusText,f=d.getResponseHeader("Content-Type")}catch(g){a=0,b="",f=void 0}0!==a&&(e=2,c.readyState=2,c.status=a,c.statusText=b,c._contentType=f,c.onreadystatechange())}},h=function(){if(g(),2===e||3===e){e=3;var a="";try{a=d.responseText}catch(b){}c.readyState=3,c.responseText=a,c.onprogress()}},i=function(){h(),(1===e||2===e||3===e)&&(e=4,0!==f&&(l(f),f=0),c.readyState=4,c.onreadystatechange())},j=function(){void 0!=d&&(4===d.readyState?i():3===d.readyState?h():2===d.readyState&&g())},n=function(){f=k(function(){n()},500),3===d.readyState&&h()};d.onload=i,d.onerror=i,d.onabort=i,"sendAsBinary"in m.prototype||"mozAnon"in m.prototype||(d.onprogress=h),d.onreadystatechange=j,"contentType"in d&&(b+=(-1===b.indexOf("?",0)?"?":"&")+"padding=true"),d.open(a,b,!0),"readyState"in d&&(f=k(function(){n()},0))},b.prototype.abort=function(){this._abort(!1)},b.prototype.getResponseHeader=function(a){return this._contentType},b.prototype.setRequestHeader=function(a,b){var c=this._xhr;"setRequestHeader"in c&&c.setRequestHeader(a,b)},b.prototype.send=function(){if(!("ontimeout"in m.prototype)&&void 0!=p&&void 0!=p.readyState&&"complete"!==p.readyState){var a=this;return void(a._sendTimeout=k(function(){a._sendTimeout=0,a.send()},4))}var b=this._xhr;b.withCredentials=this.withCredentials,b.responseType=this.responseType;try{b.send(void 0)}catch(c){throw c}},c.prototype.open=function(a,b,c,d,e,f){var g=this._xhr;g.open("GET",d);var h=0;g.onprogress=function(){var a=g.responseText,c=a.slice(h);h+=c.length,b(c)},g.onreadystatechange=function(){if(2===g.readyState){var b=g.status,d=g.statusText,e=g.getResponseHeader("Content-Type");a(b,d,e)}else 4===g.readyState&&c()},g.withCredentials=e,g.responseType="text";for(var i in f)Object.prototype.hasOwnProperty.call(f,i)&&g.setRequestHeader(i,f[i]);g.send()},c.prototype.cancel=function(){var a=this._xhr;a.abort()},d.prototype.dispatchEvent=function(a){a.target=this;var b=this._listeners[a.type];if(void 0!=b)for(var c=b.length,d=0;c>d;d+=1){var f=b[d];try{"function"==typeof f.handleEvent?f.handleEvent(a):f.call(this,a)}catch(g){e(g)}}},d.prototype.addEventListener=function(a,b){a=String(a);var c=this._listeners,d=c[a];void 0==d&&(d=[],c[a]=d);for(var e=!1,f=0;f<d.length;f+=1)d[f]===b&&(e=!0);e||d.push(b)},d.prototype.removeEventListener=function(a,b){a=String(a);var c=this._listeners,d=c[a];if(void 0!=d){for(var e=[],f=0;f<d.length;f+=1)d[f]!==b&&e.push(d[f]);0===e.length?delete c[a]:c[a]=e}},g.prototype=Object.create(f.prototype);var r=-1,s=0,t=1,u=2,v=-1,w=0,x=1,y=2,z=3,A=/^text\/event\-stream;?(\s*charset\=utf\-8)?$/i,B=1e3,C=18e6,D=function(a,b){var c=parseInt(a,10);return c!==c&&(c=b),E(c)},E=function(a){return Math.min(Math.max(a,B),C)},F=function(a,b,c){try{"function"==typeof b&&b.call(a,c)}catch(d){e(d)}};h.prototype=Object.create(d.prototype),h.prototype.CONNECTING=s,h.prototype.OPEN=t,h.prototype.CLOSED=u,h.prototype.close=function(){this._close()},h.CONNECTING=s,h.OPEN=t,h.CLOSED=u,h.prototype.withCredentials=void 0,a.EventSourcePolyfill=h,a.NativeEventSource=o,void 0==m||void 0!=o&&"withCredentials"in o.prototype||(a.EventSource=h)}("undefined"!=typeof window?window:this);